<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CodeQuest: Your Fun Coding Adventure!</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
        }
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .glassmorphism {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .code-area {
            background: #1e1e1e;
            color: #d4d4d4;
            font-family: 'Courier New', Courier, monospace;
            border-radius: 10px;
            padding: 20px;
        }
        .planet { transition: all 0.5s; filter: grayscale(100%); }
        .planet.visited { filter: grayscale(0%); transform: scale(1.1); }
        .puppy-hop { animation: hop 0.4s ease-in-out; }
        @keyframes hop {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-15px); }
        }
        .item-appear { animation: appear 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55); }
        @keyframes appear {
            0% { transform: scale(0.5); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background-color: #f00;
            opacity: 0;
            animation: confetti-fall 3s ease-out forwards;
        }
        @keyframes confetti-fall {
            0% { transform: translateY(-10vh) rotate(0deg); opacity: 1; }
            100% { transform: translateY(110vh) rotate(720deg); opacity: 0; }
        }
        .error-popup {
            transition: opacity 0.3s, transform 0.3s;
        }
    </style>
</head>
<body class="gradient-bg text-white">

    <!-- Language Selection -->
    <div class="absolute top-4 right-4 z-10">
        <select id="language-selector" class="bg-white/20 border border-white/30 rounded-md px-3 py-1 text-white">
            <option value="en">English</option>
            <option value="es">Espa√±ol</option>
            <option value="fr">Fran√ßais</option>
            <option value="hi">‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</option>
            <option value="de">Deutsch</option>
        </select>
    </div>

    <div id="main-content" class="container mx-auto px-4 py-8">
        <!-- Landing Page -->
        <section id="landing-page" class="text-center py-20">
            <h1 class="text-5xl md:text-7xl font-bold mb-4" data-key="title">CodeQuest</h1>
            <p class="text-xl md:text-2xl mb-8" data-key="subtitle">Your Fun Coding Adventure!</p>
            <p class="max-w-3xl mx-auto mb-12" data-key="description">Unlock the magic of coding through fun games and interactive challenges. Perfect for all ages and skill levels. Start your quest today!</p>
            <button id="start-demo-btn" class="bg-yellow-400 text-gray-900 font-bold py-3 px-8 rounded-full text-lg hover:bg-yellow-300 transition-transform transform hover:scale-105" data-key="start_learning">Start Your Learning</button>
        </section>

        <!-- Demo Section -->
        <section id="demo-section" class="hidden glassmorphism p-8 my-16">
            <h2 class="text-3xl font-bold text-center mb-8" data-key="demo_title">Quick Demo: See the Magic!</h2>
            <div class="flex flex-col md:flex-row gap-8">
                <div class="md:w-1/2">
                    <h3 class="text-2xl font-semibold mb-4" data-key="demo_instructions_title">Instructions</h3>
                    <p class="mb-4" data-key="demo_instructions">Type the code in the box to the right to change the color of the circle. Try typing `blue`, `green`, or `red`!</p>
                    <div class="code-area">
                        <pre>&gt; <span id="demo-code-input" contenteditable="true" class="outline-none"></span></pre>
                    </div>
                     <button id="run-demo-code-btn" class="mt-4 bg-green-500 text-white font-bold py-2 px-6 rounded-full hover:bg-green-400" data-key="run_code">Run Code</button>
                </div>
                <div class="md:w-1/2 flex flex-col items-center justify-center">
                    <div id="demo-output-circle" class="w-48 h-48 bg-yellow-400 rounded-full transition-colors duration-500"></div>
                </div>
            </div>
            <div class="text-center mt-8">
                <button id="start-levels-btn" class="bg-purple-600 text-white font-bold py-3 px-8 rounded-full text-lg hover:bg-purple-500" data-key="start_levels">Start the Real Quest!</button>
            </div>
        </section>

        <!-- Level Selection -->
        <section id="level-selection" class="hidden text-center py-16">
            <h2 class="text-4xl font-bold mb-12" data-key="levels_title">Choose Your Challenge</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <div class="glassmorphism p-8 hover:bg-white/20 cursor-pointer level-card" data-level="1">
                    <h3 class="text-2xl font-bold mb-4" data-key="level_1_title">Level 1: Maze Runner</h3>
                    <p data-key="level_1_desc">Guide the puppy through the maze to its home using directional commands.</p>
                </div>
                <div class="glassmorphism p-8 hover:bg-white/20 cursor-pointer level-card" data-level="2">
                    <h3 class="text-2xl font-bold mb-4" data-key="level_2_title">Level 2: Planet Hopper</h3>
                    <p data-key="level_2_desc">Use arrays and loops to visit a series of planets and collect fuel.</p>
                </div>
                <div class="glassmorphism p-8 hover:bg-white/20 cursor-pointer level-card" data-level="3">
                    <h3 class="text-2xl font-bold mb-4" data-key="level_3_title">Level 3: Function Forge</h3>
                    <p data-key="level_3_desc">Forge items by calling functions with parameters and add the returned items to your inventory.</p>
                </div>
            </div>
        </section>

        <!-- Game Section -->
        <section id="game-section" class="hidden glassmorphism p-8 my-16 relative">
            <div class="flex flex-col lg:flex-row gap-8">
                <!-- Game Display -->
                <div class="lg:w-1/2">
                    <h3 id="game-title" class="text-2xl font-semibold mb-4 text-center"></h3>
                    <div id="game-canvas-container" class="bg-white/10 rounded-lg aspect-square p-4 overflow-hidden">
                         <div id="game-canvas" class="relative w-full h-full bg-blue-900/20">
                            <!-- Level 1 Elements -->
                            <div id="maze-container" class="absolute w-full h-full"></div>
                            <div id="puppy" class="absolute text-2xl md:text-4xl z-10 flex items-center justify-center" style="transition: all 0.4s ease-in-out;">üê∂</div>
                            <div id="home" class="absolute text-2xl md:text-4xl flex items-center justify-center">üè°</div>
                            <!-- Level 2 Elements -->
                            <div id="spaceship" class="absolute w-12 h-12 text-4xl hidden" style="transition: all 1s cubic-bezier(0.65, 0, 0.35, 1);">üöÄ</div>
                            <div id="planets-container" class="absolute w-full h-full"></div>
                            <!-- Level 3 Elements -->
                            <div id="forge-area" class="w-full h-full flex flex-col items-center justify-center hidden">
                                <div class="text-8xl mb-8">üõ†Ô∏è</div>
                                <div id="inventory" class="w-full h-1/4 bg-black/20 rounded-lg p-4 flex items-center justify-center gap-4">
                                    <p class="text-gray-400" data-key="inventory_empty">Inventory is empty</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Coding Area & Instructions -->
                <div class="lg:w-1/2">
                    <h3 class="text-2xl font-semibold mb-4" data-key="instructions">Instructions</h3>
                    <p id="game-instructions" class="mb-4"></p>
                    <div class="code-area h-64 overflow-y-auto">
                        <textarea id="code-input" class="w-full h-full bg-transparent text-white border-none outline-none resize-none"></textarea>
                    </div>
                    <div class="flex items-center justify-between mt-4">
                        <button id="run-code-btn" class="bg-green-500 text-white font-bold py-2 px-6 rounded-full hover:bg-green-400 disabled:bg-gray-500" data-key="run_code">Run Code</button>
                        <button id="hint-btn" class="bg-blue-500 text-white font-bold py-2 px-6 rounded-full hover:bg-blue-400" data-key="get_hint">Get a Hint</button>
                    </div>
                    <div id="hint-box" class="mt-4 p-4 bg-yellow-400/20 rounded-lg hidden">
                        <p id="hint-text" class="text-yellow-200"></p>
                    </div>
                </div>
            </div>
            <div class="text-center mt-8">
                 <button id="back-to-levels-btn" class="bg-gray-700/50 text-white font-bold py-2 px-6 rounded-full hover:bg-gray-600/50" data-key="back_to_level_select">&larr; Back to Level Select</button>
            </div>
            <!-- Error Message Popup -->
            <div id="error-popup" class="error-popup hidden absolute bottom-6 left-1/2 -translate-x-1/2 bg-red-600 text-white px-6 py-3 rounded-lg shadow-xl">
                <p data-key="error_message">Oops! There's an error in your code.</p>
            </div>
        </section>
        
        <!-- Certificate Section -->
        <section id="certificate-section" class="hidden text-center py-20">
             <div class="glassmorphism p-8 max-w-3xl mx-auto">
                <h2 class="text-4xl font-bold mb-4" data-key="congrats">Congratulations!</h2>
                <p class="text-xl mb-8" data-key="level_complete">You've completed the level!</p>
                <div id="certificate-content" class="bg-white text-gray-800 p-8 rounded-lg shadow-lg text-center">
                    <h3 class="text-3xl font-bold text-purple-600">Certificate of Completion</h3>
                    <p class="my-4">This certifies that</p>
                    <p id="user-name" class="text-2xl font-semibold border-b-2 border-gray-400 pb-2">[Your Name Here]</p>
                    <p class="my-4">has successfully completed</p>
                    <p id="completed-level-name" class="text-xl font-semibold"></p>
                    <p class="mt-8 text-sm text-gray-500">Issued by CodeQuest</p>
                </div>
                <div class="mt-8">
                    <input type="text" id="name-input" placeholder="Enter your name for the certificate" class="bg-white/20 border border-white/30 rounded-md px-3 py-2 text-white w-full max-w-sm mb-4" data-key="enter_name_placeholder">
                    <button id="download-cert-btn" class="bg-green-500 text-white font-bold py-3 px-8 rounded-full text-lg hover:bg-green-400" data-key="download_cert">Download Certificate</button>
                </div>
             </div>
        </section>

    </div>

    <script>
        const translations = {
            en: {
                title: "CodeQuest", subtitle: "Your Fun Coding Adventure!", description: "Unlock the magic of coding through fun games and interactive challenges. Perfect for all ages and skill levels. Start your quest today!",
                start_learning: "Start Your Learning", demo_title: "Quick Demo: See the Magic!", demo_instructions_title: "Instructions", demo_instructions: "Type the code in the box to the right to change the color of the circle. Try typing `blue`, `green`, or `red`!",
                run_code: "Run Code", start_levels: "Start the Real Quest!", levels_title: "Choose Your Challenge",
                level_1_title: "Level 1: Maze Runner", level_1_desc: "Guide the puppy through the maze to its home using directional commands.",
                level_2_title: "Level 2: Planet Hopper", level_2_desc: "Use arrays and loops to visit a series of planets and collect fuel.",
                level_3_title: "Level 3: Function Forge", level_3_desc: "Forge items by calling functions with parameters and add the returned items to your inventory.",
                instructions: "Instructions", get_hint: "Get a Hint", back_to_level_select: "&larr; Back to Level Select",
                congrats: "Congratulations!", level_complete: "You've completed the level!",
                enter_name_placeholder: "Enter your name for the certificate", download_cert: "Download Certificate",
                game_1_instructions: "Guide the puppy home! Use `moveRight()`, `moveDown()`, `moveLeft()`, and `moveUp()` to navigate the maze.",
                game_1_hint: "The path is: Right, Right, Down, Down, Right, Right. Write the commands in order.",
                game_2_instructions: "Visit all planets to collect fuel. The planet coordinates are in the `planets` array. Use a `for` loop and `flyTo(x, y)`.",
                game_2_hint: "Loop through the array like this: for (const planet of planets) { flyTo(planet[0], planet[1]); }",
                game_3_instructions: "Forge a sword, a shield, and a helmet. Use `forge(item, material)` to create an item, then `inventory.add(item)` to store it. Valid materials are 'iron' and 'steel'.",
                game_3_hint: "Create each item and add it to the inventory, like this: const mySword = forge('sword', 'iron'); inventory.add(mySword);",
                error_message: "Oops! There's an error in your code.",
                inventory_empty: "Inventory is empty"
            },
            es: {
                title: "CodeQuest", subtitle: "¬°Tu divertida aventura de codificaci√≥n!", description: "Desbloquea la magia de la codificaci√≥n a trav√©s de divertidos juegos y desaf√≠os interactivos. Perfecto para todas las edades y niveles de habilidad. ¬°Comienza tu b√∫squeda hoy!",
                start_learning: "Empieza a Aprender", demo_title: "Demostraci√≥n r√°pida: ¬°Mira la magia!", demo_instructions_title: "Instrucciones", demo_instructions: "Escribe el c√≥digo en el cuadro de la derecha para cambiar el color del c√≠rculo. ¬°Intenta escribir `blue`, `green` o `red`!",
                run_code: "Ejecutar c√≥digo", start_levels: "¬°Comienza la verdadera b√∫squeda!", levels_title: "Elige tu desaf√≠o",
                level_1_title: "Nivel 1: Corredor de Laberinto", level_1_desc: "Gu√≠a al cachorro a trav√©s del laberinto hasta su casa usando comandos direccionales.",
                level_2_title: "Nivel 2: Saltador de Planetas", level_2_desc: "Usa arrays y bucles para visitar una serie de planetas y recolectar combustible.",
                level_3_title: "Nivel 3: Forja de Funciones", level_3_desc: "Forja objetos llamando a funciones con par√°metros y a√±ade los objetos devueltos a tu inventario.",
                instructions: "Instrucciones", get_hint: "Obtener una pista", back_to_level_select: "&larr; Volver a la selecci√≥n de nivel",
                congrats: "¬°Felicidades!", level_complete: "¬°Has completado el nivel!",
                enter_name_placeholder: "Ingresa tu nombre para el certificado", download_cert: "Descargar certificado",
                game_1_instructions: "¬°Gu√≠a al cachorro a casa! Usa `moveRight()`, `moveDown()`, `moveLeft()` y `moveUp()` para navegar por el laberinto.",
                game_1_hint: "El camino es: Derecha, Derecha, Abajo, Abajo, Derecha, Derecha. Escribe los comandos en orden.",
                game_2_instructions: "Visita todos los planetas para recolectar combustible. Las coordenadas de los planetas est√°n en el array `planets`. Usa un bucle `for` y `flyTo(x, y)`.",
                game_2_hint: "Recorre el array as√≠: for (const planet of planets) { flyTo(planet[0], planet[1]); }",
                game_3_instructions: "Forja una espada, un escudo y un casco. Usa `forge(item, material)` para crear un objeto, luego `inventory.add(item)` para guardarlo. Los materiales v√°lidos son 'iron' y 'steel'.",
                game_3_hint: "Crea cada objeto y a√±√°delo al inventario, as√≠: const miEspada = forge('sword', 'iron'); inventory.add(miEspada);",
                error_message: "¬°Ups! Hay un error en tu c√≥digo.",
                inventory_empty: "El inventario est√° vac√≠o"
            },
            fr: {
                title: "CodeQuest", subtitle: "Votre aventure de codage amusante !", description: "D√©verrouillez la magie du codage √† travers des jeux amusants et des d√©fis interactifs. Parfait pour tous les √¢ges et tous les niveaux. Commencez votre qu√™te aujourd'hui !",
                start_learning: "Commencez √† Apprendre", demo_title: "D√©mo rapide : Voyez la magie !", demo_instructions_title: "Instructions", demo_instructions: "Tapez le code dans la case √† droite pour changer la couleur du cercle. Essayez de taper `blue`, `green` ou `red` !",
                run_code: "Ex√©cuter le code", start_levels: "Commencez la vraie qu√™te !", levels_title: "Choisissez votre d√©fi",
                level_1_title: "Niveau 1 : Le Labyrinthe", level_1_desc: "Guidez le chiot √† travers le labyrinthe jusqu'√† sa maison √† l'aide de commandes directionnelles.",
                level_2_title: "Niveau 2 : Sauteur de Plan√®tes", level_2_desc: "Utilisez des tableaux et des boucles pour visiter une s√©rie de plan√®tes et collecter du carburant.",
                level_3_title: "Niveau 3 : Forge de Fonctions", level_3_desc: "Forgez des objets en appelant des fonctions avec des param√®tres et ajoutez les objets retourn√©s √† votre inventaire.",
                instructions: "Instructions", get_hint: "Obtenir un indice", back_to_level_select: "&larr; Retour √† la s√©lection des niveaux",
                congrats: "F√©licitations !", level_complete: "Vous avez termin√© le niveau !",
                enter_name_placeholder: "Entrez votre nom pour le certificat", download_cert: "T√©l√©charger le certificat",
                game_1_instructions: "Guidez le chiot √† la maison ! Utilisez `moveRight()`, `moveDown()`, `moveLeft()` et `moveUp()` pour naviguer dans le labyrinthe.",
                game_1_hint: "Le chemin est : Droite, Droite, Bas, Bas, Droite, Droite. √âcrivez les commandes dans l'ordre.",
                game_2_instructions: "Visitez toutes les plan√®tes pour collecter du carburant. Les coordonn√©es des plan√®tes se trouvent dans le tableau `planets`. Utilisez une boucle `for` et `flyTo(x, y)`.",
                game_2_hint: "Parcourez le tableau comme ceci : for (const planet of planets) { flyTo(planet[0], planet[1]); }",
                game_3_instructions: "Forgez une √©p√©e, un bouclier et un casque. Utilisez `forge(item, material)` pour cr√©er un objet, puis `inventory.add(item)` pour le stocker. Les mat√©riaux valides sont 'iron' et 'steel'.",
                game_3_hint: "Cr√©ez chaque objet et ajoutez-le √† l'inventaire, comme ceci : const monEpee = forge('sword', 'iron'); inventory.add(monEpee);",
                error_message: "Oups ! Il y a une erreur dans votre code.",
                inventory_empty: "L'inventaire est vide"
            },
            hi: {
                title: "‡§ï‡•ã‡§°‡§ï‡•ç‡§µ‡•á‡§∏‡•ç‡§ü", subtitle: "‡§Ü‡§™‡§ï‡§æ ‡§Æ‡§ú‡•á‡§¶‡§æ‡§∞ ‡§ï‡•ã‡§°‡§ø‡§Ç‡§ó ‡§è‡§°‡§µ‡•á‡§Ç‡§ö‡§∞!", description: "‡§Æ‡§ú‡•á‡§¶‡§æ‡§∞ ‡§ñ‡•á‡§≤‡•ã‡§Ç ‡§î‡§∞ ‡§á‡§Ç‡§ü‡§∞‡•à‡§ï‡•ç‡§ü‡§ø‡§µ ‡§ö‡•Å‡§®‡•å‡§§‡§ø‡§Ø‡•ã‡§Ç ‡§ï‡•á ‡§Æ‡§æ‡§ß‡•ç‡§Ø‡§Æ ‡§∏‡•á ‡§ï‡•ã‡§°‡§ø‡§Ç‡§ó ‡§ï‡•á ‡§ú‡§æ‡§¶‡•Ç ‡§ï‡•ã ‡§Ö‡§®‡§≤‡•â‡§ï ‡§ï‡§∞‡•á‡§Ç‡•§ ‡§∏‡§≠‡•Ä ‡§â‡§Æ‡•ç‡§∞ ‡§î‡§∞ ‡§ï‡•å‡§∂‡§≤ ‡§∏‡•ç‡§§‡§∞‡•ã‡§Ç ‡§ï‡•á ‡§≤‡§ø‡§è ‡§¨‡§ø‡§≤‡•ç‡§ï‡•Å‡§≤ ‡§∏‡§π‡•Ä‡•§ ‡§Ü‡§ú ‡§π‡•Ä ‡§Ö‡§™‡§®‡•Ä ‡§ñ‡•ã‡§ú ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•á‡§Ç!",
                start_learning: "‡§∏‡•Ä‡§ñ‡§®‡§æ ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•á‡§Ç", demo_title: "‡§§‡•ç‡§µ‡§∞‡§ø‡§§ ‡§°‡•á‡§Æ‡•ã: ‡§ú‡§æ‡§¶‡•Ç ‡§¶‡•á‡§ñ‡•á‡§Ç!", demo_instructions_title: "‡§®‡§ø‡§∞‡•ç‡§¶‡•á‡§∂", demo_instructions: "‡§µ‡•É‡§§‡•ç‡§§ ‡§ï‡§æ ‡§∞‡§Ç‡§ó ‡§¨‡§¶‡§≤‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§¶‡§æ‡§à‡§Ç ‡§ì‡§∞ ‡§¶‡§ø‡§è ‡§ó‡§è ‡§¨‡•â‡§ï‡•ç‡§∏ ‡§Æ‡•á‡§Ç ‡§ï‡•ã‡§° ‡§ü‡§æ‡§á‡§™ ‡§ï‡§∞‡•á‡§Ç‡•§ `blue`, `green`, ‡§Ø‡§æ `red` ‡§ü‡§æ‡§á‡§™ ‡§ï‡§∞‡§®‡•á ‡§ï‡§æ ‡§™‡•ç‡§∞‡§Ø‡§æ‡§∏ ‡§ï‡§∞‡•á‡§Ç!",
                run_code: "‡§ï‡•ã‡§° ‡§ö‡§≤‡§æ‡§è‡§Å", start_levels: "‡§Ö‡§∏‡§≤‡•Ä ‡§ñ‡•ã‡§ú ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•á‡§Ç!", levels_title: "‡§Ö‡§™‡§®‡•Ä ‡§ö‡•Å‡§®‡•å‡§§‡•Ä ‡§ö‡•Å‡§®‡•á‡§Ç",
                level_1_title: "‡§∏‡•ç‡§§‡§∞ 1: ‡§≠‡•Ç‡§≤‡§≠‡•Å‡§≤‡•à‡§Ø‡§æ ‡§ß‡§æ‡§µ‡§ï", level_1_desc: "‡§¶‡§ø‡§∂‡§æ‡§§‡•ç‡§Æ‡§ï ‡§Ü‡§¶‡•á‡§∂‡•ã‡§Ç ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡§ï‡•á ‡§™‡§ø‡§≤‡•ç‡§≤‡•á ‡§ï‡•ã ‡§≠‡•Ç‡§≤‡§≠‡•Å‡§≤‡•à‡§Ø‡§æ ‡§ï‡•á ‡§Æ‡§æ‡§ß‡•ç‡§Ø‡§Æ ‡§∏‡•á ‡§â‡§∏‡§ï‡•á ‡§ò‡§∞ ‡§§‡§ï ‡§Æ‡§æ‡§∞‡•ç‡§ó‡§¶‡§∞‡•ç‡§∂‡§® ‡§ï‡§∞‡•á‡§Ç‡•§",
                level_2_title: "‡§∏‡•ç‡§§‡§∞ 2: ‡§ó‡•ç‡§∞‡§π ‡§π‡•â‡§™‡§∞", level_2_desc: "‡§ó‡•ç‡§∞‡§π‡•ã‡§Ç ‡§ï‡•Ä ‡§è‡§ï ‡§∂‡•ç‡§∞‡•É‡§Ç‡§ñ‡§≤‡§æ ‡§™‡§∞ ‡§ú‡§æ‡§®‡•á ‡§î‡§∞ ‡§à‡§Ç‡§ß‡§® ‡§á‡§ï‡§ü‡•ç‡§†‡§æ ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§è‡§∞‡•á ‡§î‡§∞ ‡§≤‡•Ç‡§™ ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡•á‡§Ç‡•§",
                level_3_title: "‡§∏‡•ç‡§§‡§∞ 3: ‡§´‡§Ç‡§ï‡•ç‡§∂‡§® ‡§´‡•ã‡§∞‡•ç‡§ú", level_3_desc: "‡§™‡•à‡§∞‡§æ‡§Æ‡•Ä‡§ü‡§∞ ‡§ï‡•á ‡§∏‡§æ‡§• ‡§´‡§º‡§Ç‡§ï‡•ç‡§∂‡§® ‡§ï‡•â‡§≤ ‡§ï‡§∞‡§ï‡•á ‡§Ü‡§á‡§ü‡§Æ ‡§¨‡§®‡§æ‡§è‡§Ç ‡§î‡§∞ ‡§≤‡•å‡§ü‡§æ‡§è ‡§ó‡§è ‡§Ü‡§á‡§ü‡§Æ ‡§ï‡•ã ‡§Ö‡§™‡§®‡•Ä ‡§á‡§®‡•ç‡§µ‡•á‡§Ç‡§ü‡•ç‡§∞‡•Ä ‡§Æ‡•á‡§Ç ‡§ú‡•ã‡§°‡§º‡•á‡§Ç‡•§",
                instructions: "‡§®‡§ø‡§∞‡•ç‡§¶‡•á‡§∂", get_hint: "‡§∏‡§Ç‡§ï‡•á‡§§ ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§ï‡§∞‡•á‡§Ç", back_to_level_select: "&larr; ‡§∏‡•ç‡§§‡§∞ ‡§ö‡§Ø‡§® ‡§™‡§∞ ‡§µ‡§æ‡§™‡§∏",
                congrats: "‡§¨‡§ß‡§æ‡§à ‡§π‡•ã!", level_complete: "‡§Ü‡§™‡§®‡•á ‡§∏‡•ç‡§§‡§∞ ‡§™‡•Ç‡§∞‡§æ ‡§ï‡§∞ ‡§≤‡§ø‡§Ø‡§æ ‡§π‡•à!",
                enter_name_placeholder: "‡§™‡•ç‡§∞‡§Æ‡§æ‡§£ ‡§™‡§§‡•ç‡§∞ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ö‡§™‡§®‡§æ ‡§®‡§æ‡§Æ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç", download_cert: "‡§™‡•ç‡§∞‡§Æ‡§æ‡§£ ‡§™‡§§‡•ç‡§∞ ‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç",
                game_1_instructions: "‡§™‡§ø‡§≤‡•ç‡§≤‡•á ‡§ï‡•ã ‡§ò‡§∞ ‡§§‡§ï ‡§Æ‡§æ‡§∞‡•ç‡§ó‡§¶‡§∞‡•ç‡§∂‡§® ‡§ï‡§∞‡•á‡§Ç! ‡§≠‡•Ç‡§≤‡§≠‡•Å‡§≤‡•à‡§Ø‡§æ ‡§Æ‡•á‡§Ç ‡§®‡•á‡§µ‡§ø‡§ó‡•á‡§ü ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è `moveRight()`, `moveDown()`, `moveLeft()`, ‡§î‡§∞ `moveUp()` ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡•á‡§Ç‡•§",
                game_1_hint: "‡§∞‡§æ‡§∏‡•ç‡§§‡§æ ‡§π‡•à: ‡§¶‡§æ‡§è‡§Å, ‡§¶‡§æ‡§è‡§Å, ‡§®‡•Ä‡§ö‡•á, ‡§®‡•Ä‡§ö‡•á, ‡§¶‡§æ‡§è‡§Å, ‡§¶‡§æ‡§è‡§Å‡•§ ‡§Ü‡§¶‡•á‡§∂‡•ã‡§Ç ‡§ï‡•ã ‡§ï‡•ç‡§∞‡§Æ ‡§Æ‡•á‡§Ç ‡§≤‡§ø‡§ñ‡•á‡§Ç‡•§",
                game_2_instructions: "‡§à‡§Ç‡§ß‡§® ‡§á‡§ï‡§ü‡•ç‡§†‡§æ ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§∏‡§≠‡•Ä ‡§ó‡•ç‡§∞‡§π‡•ã‡§Ç ‡§™‡§∞ ‡§ú‡§æ‡§è‡§Å‡•§ ‡§ó‡•ç‡§∞‡§π‡•ã‡§Ç ‡§ï‡•á ‡§®‡§ø‡§∞‡•ç‡§¶‡•á‡§∂‡§æ‡§Ç‡§ï `planets` ‡§ê‡§∞‡•á ‡§Æ‡•á‡§Ç ‡§π‡•à‡§Ç‡•§ `for` ‡§≤‡•Ç‡§™ ‡§î‡§∞ `flyTo(x, y)` ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡•á‡§Ç‡•§",
                game_2_hint: "‡§ê‡§∞‡•á ‡§ï‡•ã ‡§á‡§∏ ‡§§‡§∞‡§π ‡§≤‡•Ç‡§™ ‡§ï‡§∞‡•á‡§Ç: for (const planet of planets) { flyTo(planet[0], planet[1]); }",
                game_3_instructions: "‡§è‡§ï ‡§§‡§≤‡§µ‡§æ‡§∞, ‡§è‡§ï ‡§¢‡§æ‡§≤ ‡§î‡§∞ ‡§è‡§ï ‡§π‡•á‡§≤‡§Æ‡•á‡§ü ‡§¨‡§®‡§æ‡§è‡§Ç‡•§ ‡§è‡§ï ‡§Ü‡§á‡§ü‡§Æ ‡§¨‡§®‡§æ‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è `forge(item, material)` ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡•á‡§Ç, ‡§´‡§ø‡§∞ ‡§á‡§∏‡•á ‡§∏‡•ç‡§ü‡•ã‡§∞ ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è `inventory.add(item)` ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡•á‡§Ç‡•§ ‡§Æ‡§æ‡§®‡•ç‡§Ø ‡§∏‡§æ‡§Æ‡§ó‡•ç‡§∞‡•Ä 'iron' ‡§î‡§∞ 'steel' ‡§π‡•à‡§Ç‡•§",
                game_3_hint: "‡§™‡•ç‡§∞‡§§‡•ç‡§Ø‡•á‡§ï ‡§Ü‡§á‡§ü‡§Æ ‡§¨‡§®‡§æ‡§è‡§Ç ‡§î‡§∞ ‡§á‡§∏‡•á ‡§á‡§®‡•ç‡§µ‡•á‡§Ç‡§ü‡•ç‡§∞‡•Ä ‡§Æ‡•á‡§Ç ‡§ú‡•ã‡§°‡§º‡•á‡§Ç, ‡§á‡§∏ ‡§§‡§∞‡§π: const meriTalwar = forge('sword', 'iron'); inventory.add(meriTalwar);",
                error_message: "‡§ì‡§π! ‡§Ü‡§™‡§ï‡•á ‡§ï‡•ã‡§° ‡§Æ‡•á‡§Ç ‡§è‡§ï ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø ‡§π‡•à‡•§",
                inventory_empty: "‡§á‡§®‡•ç‡§µ‡•á‡§Ç‡§ü‡•ç‡§∞‡•Ä ‡§ñ‡§æ‡§≤‡•Ä ‡§π‡•à"
            },
            de: {
                title: "CodeQuest", subtitle: "Dein lustiges Programmier-Abenteuer!", description: "Entfessle die Magie des Programmierens durch lustige Spiele und interaktive Herausforderungen. Perfekt f√ºr alle Altersgruppen und F√§higkeitsstufen. Starte noch heute deine Quest!",
                start_learning: "Beginne zu Lernen", demo_title: "Schnelldemo: Sieh die Magie!", demo_instructions_title: "Anweisungen", demo_instructions: "Gib den Code in das Feld rechts ein, um die Farbe des Kreises zu √§ndern. Versuche `blue`, `green` oder `red` einzugeben!",
                run_code: "Code ausf√ºhren", start_levels: "Starte die echte Quest!", levels_title: "W√§hle deine Herausforderung",
                level_1_title: "Level 1: Labyrinthl√§ufer", level_1_desc: "F√ºhre den Welpen mit Richtungsbefehlen durch das Labyrinth nach Hause.",
                level_2_title: "Level 2: Planetenh√ºpfer", level_2_desc: "Verwende Arrays und Schleifen, um eine Reihe von Planeten zu besuchen und Treibstoff zu sammeln.",
                level_3_title: "Level 3: Funktionsschmiede", level_3_desc: "Schmiede Gegenst√§nde, indem du Funktionen mit Parametern aufrufst und die zur√ºckgegebenen Gegenst√§nde deinem Inventar hinzuf√ºgst.",
                instructions: "Anweisungen", get_hint: "Hinweis erhalten", back_to_level_select: "&larr; Zur√ºck zur Levelauswahl",
                congrats: "Herzlichen Gl√ºckwunsch!", level_complete: "Du hast das Level abgeschlossen!",
                enter_name_placeholder: "Gib deinen Namen f√ºr das Zertifikat ein", download_cert: "Zertifikat herunterladen",
                game_1_instructions: "F√ºhre den Welpen nach Hause! Benutze `moveRight()`, `moveDown()`, `moveLeft()` und `moveUp()`, um durch das Labyrinth zu navigieren.",
                game_1_hint: "Der Weg ist: Rechts, Rechts, Runter, Runter, Rechts, Rechts. Schreibe die Befehle in der richtigen Reihenfolge.",
                game_2_instructions: "Besuche alle Planeten, um Treibstoff zu sammeln. Die Planetenkoordinaten befinden sich im `planets`-Array. Benutze eine `for`-Schleife und `flyTo(x, y)`.",
                game_2_hint: "Durchlaufe das Array so: for (const planet of planets) { flyTo(planet[0], planet[1]); }",
                game_3_instructions: "Schmiede ein Schwert, einen Schild und einen Helm. Benutze `forge(item, material)`, um einen Gegenstand zu erstellen, und dann `inventory.add(item)`, um ihn zu lagern. G√ºltige Materialien sind 'iron' und 'steel'.",
                game_3_hint: "Erstelle jeden Gegenstand und f√ºge ihn dem Inventar hinzu, so: const meinSchwert = forge('sword', 'iron'); inventory.add(meinSchwert);",
                error_message: "Hoppla! Es ist ein Fehler in deinem Code aufgetreten.",
                inventory_empty: "Inventar ist leer"
            }
        };

        // --- SOUND ENGINE ---
        let synth;
        let audioReady = false;

        async function initAudio() {
            if (audioReady) return;
            if (window.Tone) {
                try {
                    await Tone.start();
                    synth = new Tone.Synth().toDestination();
                    audioReady = true;
                    console.log("Audio ready");
                } catch (e) {
                    console.error("Could not start audio", e);
                }
            }
        }

        const playSound = (note, duration = '8n') => {
            if (!audioReady) return;
            synth.triggerAttackRelease(note, duration);
        };

        const playSuccessSound = () => {
            if (!audioReady) return;
            const now = Tone.now();
            synth.triggerAttackRelease("C4", "8n", now);
            synth.triggerAttackRelease("E4", "8n", now + 0.2);
            synth.triggerAttackRelease("G4", "8n", now + 0.4);
        };

        const playErrorSound = () => playSound("C3", "4n");

        // --- UI & LANGUAGE ---
        const languageSelector = document.getElementById('language-selector');
        const allTextElements = document.querySelectorAll('[data-key]');

        function changeLanguage(lang) {
            allTextElements.forEach(element => {
                const key = element.getAttribute('data-key');
                if (translations[lang] && translations[lang][key]) {
                    element.innerHTML = translations[lang][key];
                }
            });
            const nameInput = document.getElementById('name-input');
            if (nameInput && translations[lang] && translations[lang]['enter_name_placeholder']) {
                nameInput.placeholder = translations[lang]['enter_name_placeholder'];
            }
        }

        languageSelector.addEventListener('change', (e) => changeLanguage(e.target.value));
        changeLanguage('en');

        // --- PAGE NAVIGATION ---
        const landingPage = document.getElementById('landing-page');
        const demoSection = document.getElementById('demo-section');
        const levelSelection = document.getElementById('level-selection');
        const gameSection = document.getElementById('game-section');
        const certificateSection = document.getElementById('certificate-section');
        
        const startDemoBtn = document.getElementById('start-demo-btn');
        const startLevelsBtn = document.getElementById('start-levels-btn');
        const backToLevelsBtn = document.getElementById('back-to-levels-btn');
        const levelCards = document.querySelectorAll('.level-card');

        function showSection(section) {
            [landingPage, demoSection, levelSelection, gameSection, certificateSection].forEach(s => s.classList.add('hidden'));
            section.classList.remove('hidden');
        }

        startDemoBtn.addEventListener('click', () => showSection(demoSection));
        startLevelsBtn.addEventListener('click', () => showSection(levelSelection));
        backToLevelsBtn.addEventListener('click', () => showSection(levelSelection));

        // --- DEMO LOGIC ---
        const demoCodeInput = document.getElementById('demo-code-input');
        const runDemoCodeBtn = document.getElementById('run-demo-code-btn');
        const demoOutputCircle = document.getElementById('demo-output-circle');

        runDemoCodeBtn.addEventListener('click', () => {
            const code = demoCodeInput.innerText.trim().toLowerCase();
            demoOutputCircle.style.backgroundColor = ['red', 'green', 'blue'].includes(code) ? code : 'yellow';
        });
        
        // --- GAME LOGIC ---
        const gameTitle = document.getElementById('game-title');
        const gameInstructions = document.getElementById('game-instructions');
        const codeInput = document.getElementById('code-input');
        const runCodeBtn = document.getElementById('run-code-btn');
        const hintBtn = document.getElementById('hint-btn');
        const hintBox = document.getElementById('hint-box');
        const hintText = document.getElementById('hint-text');
        const errorPopup = document.getElementById('error-popup');
        
        const puppy = document.getElementById('puppy');
        const home = document.getElementById('home');
        const mazeContainer = document.getElementById('maze-container');
        const spaceship = document.getElementById('spaceship');
        const planetsContainer = document.getElementById('planets-container');
        const forgeArea = document.getElementById('forge-area');
        const inventory = document.getElementById('inventory');

        let currentLevel = 1;
        const GRID_SIZE = 5;
        let puppyPos = { x: 0, y: 0 };
        let planetsToVisit = [];
        let visitedPlanets = 0;
        let inventoryItems = new Set();

        function hideAllGameElements() {
            [puppy, home, mazeContainer, spaceship, planetsContainer, forgeArea].forEach(el => el.classList.add('hidden'));
            [mazeContainer, planetsContainer].forEach(c => c.innerHTML = '');
        }

        function setupLevel(level) {
            currentLevel = level;
            showSection(gameSection);
            hintBox.classList.add('hidden');
            errorPopup.classList.add('hidden');
            hideAllGameElements();
            const lang = languageSelector.value;
            codeInput.value = '';

            if (level === 1) {
                gameTitle.innerText = translations[lang].level_1_title;
                gameInstructions.innerText = translations[lang].game_1_instructions;
                hintText.innerText = translations[lang].game_1_hint;
                [puppy, home, mazeContainer].forEach(el => el.classList.remove('hidden'));
                resetLevel1();
            } else if (level === 2) {
                gameTitle.innerText = translations[lang].level_2_title;
                gameInstructions.innerText = translations[lang].game_2_instructions;
                hintText.innerText = translations[lang].game_2_hint;
                [spaceship, planetsContainer].forEach(el => el.classList.remove('hidden'));
                resetLevel2();
            } else if (level === 3) {
                gameTitle.innerText = translations[lang].level_3_title;
                gameInstructions.innerText = translations[lang].game_3_instructions;
                hintText.innerText = translations[lang].game_3_hint;
                [forgeArea].forEach(el => el.classList.remove('hidden'));
                resetLevel3();
            }
        }
        
        function resetLevel1() {
            puppyPos = { x: 0, y: 0 };
            const mazeLayout = [
                [0, 0, 1, 0, 0], [1, 0, 1, 0, 1], [1, 0, 0, 0, 1], [1, 1, 1, 0, 1], [0, 0, 0, 0, 0],
            ];
            mazeContainer.innerHTML = '';
            for(let y = 0; y < GRID_SIZE; y++) {
                for(let x = 0; x < GRID_SIZE; x++) {
                    const cell = document.createElement('div');
                    cell.style.cssText = `width:${100/GRID_SIZE}%; height:${100/GRID_SIZE}%; position:absolute; left:${x*(100/GRID_SIZE)}%; top:${y*(100/GRID_SIZE)}%;`;
                    if (mazeLayout[y][x] === 1) {
                        cell.style.backgroundColor = 'rgba(0,0,50,0.5)';
                        cell.classList.add('wall');
                    }
                    mazeContainer.appendChild(cell);
                }
            }
            const elementSize = `${100 / GRID_SIZE}%`;
            [puppy, home].forEach(el => {
                el.style.width = elementSize;
                el.style.height = elementSize;
            });
            puppy.style.left = `${puppyPos.x * (100/GRID_SIZE)}%`;
            puppy.style.top = `${puppyPos.y * (100/GRID_SIZE)}%`;
            home.style.left = `${(GRID_SIZE - 1) * (100/GRID_SIZE)}%`;
            home.style.top = `${(GRID_SIZE - 1) * (100/GRID_SIZE)}%`;
        }

        function resetLevel2() {
            visitedPlanets = 0;
            spaceship.style.left = 'calc(50% - 24px)';
            spaceship.style.top = 'calc(90% - 24px)';
            planetsContainer.innerHTML = '';
            planetsToVisit = [[20, 20], [80, 40], [50, 60]];
            planetsToVisit.forEach(([x,y], i) => {
                const planet = document.createElement('div');
                planet.className = 'planet absolute text-5xl';
                planet.innerHTML = ['ü™ê', 'üåï', '‚ú®'][i];
                planet.style.left = `calc(${x}% - 30px)`;
                planet.style.top = `calc(${y}% - 30px)`;
                planetsContainer.appendChild(planet);
            });
        }

        function resetLevel3() {
            inventoryItems.clear();
            const lang = languageSelector.value;
            inventory.innerHTML = `<p class="text-gray-400" data-key="inventory_empty">${translations[lang].inventory_empty}</p>`;
        }
        
        levelCards.forEach(card => card.addEventListener('click', () => setupLevel(parseInt(card.dataset.level))));

        hintBtn.addEventListener('click', () => hintBox.classList.toggle('hidden'));
        runCodeBtn.addEventListener('click', () => executeCode(codeInput.value));

        async function executeCode(code) {
            await initAudio(); // Initialize audio on first run
            runCodeBtn.disabled = true;
            errorPopup.classList.add('hidden');
            
            // Level 1 functions
            const moveRight = async () => await movePuppy(1, 0);
            const moveLeft = async () => await movePuppy(-1, 0);
            const moveDown = async () => await movePuppy(0, 1);
            const moveUp = async () => await movePuppy(0, -1);
            
            // Level 2 functions
            const planets = planetsToVisit;
            const flyTo = async (x, y) => await flySpaceship(x, y);

            // Level 3 functions
            const forge = (item, material) => forgeItem(item, material);
            const inventoryAPI = { add: (item) => addToInventory(item) };


            if (currentLevel === 1) resetLevel1();
            if (currentLevel === 2) resetLevel2();
            if (currentLevel === 3) resetLevel3();

            try {
                const asyncFunction = new Function('moveRight', 'moveLeft', 'moveDown', 'moveUp', 'planets', 'flyTo', 'forge', 'inventory', `return (async () => { ${code} })()`);
                await asyncFunction(moveRight, moveLeft, moveDown, moveUp, planets, flyTo, forge, inventoryAPI);
                checkWinCondition();
            } catch (e) {
                playErrorSound();
                console.error("Execution error:", e);
                errorPopup.classList.remove('hidden');
                setTimeout(() => errorPopup.classList.add('hidden'), 3000);
            } finally {
                runCodeBtn.disabled = false;
            }
        }
        
        function movePuppy(dx, dy) {
            return new Promise(resolve => {
                const newX = puppyPos.x + dx;
                const newY = puppyPos.y + dy;
                let moved = false;
                if (newX >= 0 && newX < GRID_SIZE && newY >= 0 && newY < GRID_SIZE) {
                     const targetCell = mazeContainer.children[newY * GRID_SIZE + newX];
                     if(!targetCell.classList.contains('wall')) {
                        puppyPos.x = newX;
                        puppyPos.y = newY;
                        moved = true;
                     }
                }
                if (moved) {
                    playSound("C4");
                    puppy.classList.add('puppy-hop');
                    setTimeout(() => puppy.classList.remove('puppy-hop'), 400);
                } else {
                    playErrorSound();
                }
                puppy.style.left = `${puppyPos.x * (100/GRID_SIZE)}%`;
                puppy.style.top = `${puppyPos.y * (100/GRID_SIZE)}%`;
                setTimeout(resolve, 400);
            });
        }

        async function flySpaceship(x, y) {
            playSound("A2", "1s");
            spaceship.style.left = `calc(${x}% - 24px)`;
            spaceship.style.top = `calc(${y}% - 24px)`;
            await new Promise(r => setTimeout(r, 1000));
            
            const planets = planetsContainer.querySelectorAll('.planet');
            planets.forEach((planet, index) => {
                const [px, py] = planetsToVisit[index];
                if (Math.abs(px - x) < 5 && Math.abs(py - y) < 5 && !planet.classList.contains('visited')) {
                    planet.classList.add('visited');
                    visitedPlanets++;
                    playSound("G4");
                }
            });
        }

        function forgeItem(item, material) {
            playSound("E3");
            const validItems = {
                sword: { iron: '‚öîÔ∏è', steel: 'üó°Ô∏è' },
                shield: { iron: 'üõ°Ô∏è', steel: 'ÔøΩÔ∏è' },
                helmet: { iron: 'ü™ñ', steel: 'ü™ñ' }
            };
            if (validItems[item] && validItems[item][material]) {
                return validItems[item][material];
            }
            return null; // Return null if invalid
        }

        function addToInventory(itemEmoji) {
            if (!itemEmoji) return; // Do nothing if item is null
            if (inventoryItems.size === 0) {
                inventory.innerHTML = ''; // Clear "empty" message
            }
            inventoryItems.add(itemEmoji);
            
            // Re-render inventory to avoid duplicates
            inventory.innerHTML = '';
            inventoryItems.forEach(item => {
                const itemEl = document.createElement('div');
                itemEl.className = 'text-5xl item-appear';
                itemEl.innerText = item;
                inventory.appendChild(itemEl);
            });
        }
        
        function checkWinCondition() {
            let won = false;
            if (currentLevel === 1 && puppyPos.x === GRID_SIZE - 1 && puppyPos.y === GRID_SIZE - 1) won = true;
            if (currentLevel === 2 && visitedPlanets === planetsToVisit.length) won = true;
            if (currentLevel === 3) {
                if (inventoryItems.has('‚öîÔ∏è') || inventoryItems.has('üó°Ô∏è')) {
                    if (inventoryItems.has('üõ°Ô∏è') && inventoryItems.has('ü™ñ')) {
                        won = true;
                    }
                }
            }
            if (won) {
                triggerConfetti();
                playSuccessSound();
                setTimeout(() => showCertificate(currentLevel), 2000);
            }
        }

        // --- EFFECTS ---
        function triggerConfetti() {
            for (let i = 0; i < 100; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = `${Math.random() * 100}vw`;
                confetti.style.backgroundColor = `hsl(${Math.random() * 360}, 100%, 50%)`;
                confetti.style.animationDelay = `${Math.random() * 2}s`;
                document.body.appendChild(confetti);
                setTimeout(() => confetti.remove(), 3000);
            }
        }
        
        // --- CERTIFICATE LOGIC ---
        const nameInput = document.getElementById('name-input');
        const userName = document.getElementById('user-name');
        const downloadCertBtn = document.getElementById('download-cert-btn');
        const completedLevelName = document.getElementById('completed-level-name');
        const certificateContent = document.getElementById('certificate-content');

        nameInput.addEventListener('input', (e) => {
            userName.innerText = e.target.value || "[Your Name Here]";
        });
        
        function showCertificate(level) {
            showSection(certificateSection);
            const lang = languageSelector.value;
            const levelKey = `level_${level}_title`;
            completedLevelName.innerText = translations[lang][levelKey] || `Level ${level}`;
        }
        
        downloadCertBtn.addEventListener('click', () => {
            html2canvas(certificateContent).then(canvas => {
                const link = document.createElement('a');
                link.download = 'CodeQuest-Certificate.png';
                link.href = canvas.toDataURL('image/png');
                link.click();
            });
        });
    </script>
</body>
</html>
